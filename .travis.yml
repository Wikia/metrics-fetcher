sudo: false
language: go
matrix:
  allow_failures:
  - go: tip
  include:
  - go: 1.5.4
    env: GO15VENDOREXPERIMENT=1
  - go: 1.6.3
  - go: 1.7.1
    env: SEND_COVERAGE=1
  - go: tip
before_install:
- go get github.com/mattn/goveralls
- go get github.com/modocache/gover
- go get github.com/laher/goxc
install:
- make prepare
script:
- if ([ "$SEND_COVERAGE" == "1" ]); then make test-cover; else make test; fi
- make fmt-check
- if ([ "$TRAVIS_GO_VERSION" != "1.5.4" ]); then make lint; fi
- make vet
before_deploy:
- goxc
deploy:
  provider: releases
  api_key:
    secure: 3hvNnCyyEMbZDTUzDmkC/9wZqxzK3emMGUqzdiiDiTzZdnuQ9IDIt928/LCC5VMxATCfXhl/k2wJtY5uQufig/yv/lTUJZqjk53j5ME0CChsAs6H4YH0QUw7yOPLsUSksIMC9m+5Zjk8TCG0Iy+HfazsCzpH6Oi4gHJ0ZHtZGCRWKsgfh4EqU7th6TajwUvwg+yltD2c5+wPDmA92tVMKo1WdZzTEc7H643xm34z4pKzOcd+tbnkC5BmdcoCls7Hcg7Uen3nplqlf2TAhNGt5qVVFNyGyREv2rIRLbtB55XaGKxGkDu61sBno/ZbSYoNUyYyxqg9enpRJHNwulH1XjOHH2cmgSB+STceeIEUIXyF+JM1WS4zn/ssE7vplQb8q/b7AY+ueBSEX6IPm7MKuvol+Qp1uRMGa7mxt7Xs38Gdo792gbsXAhWOfWRz7j3vlr4MwOmA2RJ0Mp61Ht4AYR8Rp/NVYsB4wWRNGbnE0Pl+agOQ6nKGeTio+7163WD63RNIMfFOkNQXRl+kZPlmRV96nJ+nCdciInUHtX1F/MwBEk+3WkuwGTURWLPaeIWf05XHfHdDgA8vc9kT+eUwF9PFvuZR35YYgLvenF2uN6k2VlU7AOdys3X9JMv84QGAGqVvwomJiCcPDuYeVuYEg+eiEUDfsyUqODj3KGTwZaE=
  file:
  - $HOME/gopath/bin/metrics-fetcher-xc/$TRAVIS_TAG/metrics-fetcher_$TRAVIS_TAG_linux_arm.tar.gz
  - $HOME/gopath/bin/metrics-fetcher-xc/$TRAVIS_TAG/metrics-fetcher_$TRAVIS_TAG_linux_386.tar.gz
  - $HOME/gopath/bin/metrics-fetcher-xc/$TRAVIS_TAG/metrics-fetcher_$TRAVIS_TAG_linux_amd64.tar.gz
  - $HOME/gopath/bin/metrics-fetcher-xc/$TRAVIS_TAG/metrics-fetcher_$TRAVIS_TAG_i386.deb
  - $HOME/gopath/bin/metrics-fetcher-xc/$TRAVIS_TAG/metrics-fetcher_$TRAVIS_TAG_amd6.deb
  - $HOME/gopath/bin/metrics-fetcher-xc/$TRAVIS_TAG/metrics-fetcher_$TRAVIS_TAG_armhf.deb
  skip_cleanup: true
  on:
    tags: true
    go: 1.7.1
after_success:
- if ([ "$SEND_COVERAGE" == "1" ]); then gover && $HOME/gopath/bin/goveralls -service=travis-ci
  -coverprofile=gover.coverprofile; fi
os:
- linux
notifications:
  email: false