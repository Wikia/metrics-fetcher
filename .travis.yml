sudo: false
language: go
matrix:
  allow_failures:
  - go: tip
  include:
  - go: 1.5.4
    env: GO15VENDOREXPERIMENT=1
  - go: 1.6.3
  - go: 1.7.1
    env: SEND_COVERAGE=1
  - go: tip
before_install:
- go get github.com/mattn/goveralls
- go get github.com/modocache/gover
- go get github.com/laher/goxc
install:
- make prepare
script:
- if ([ "$SEND_COVERAGE" == "1" ]); then make test-cover; else make test; fi
- make fmt-check
- if ([ "$TRAVIS_GO_VERSION" != "1.5.4" ]); then make lint; fi
- make vet
before_deploy:
- goxc
after_success:
- if ([ "$SEND_COVERAGE" == "1" ]); then gover && $HOME/gopath/bin/goveralls -service=travis-ci
  -coverprofile=gover.coverprofile; fi
os:
- linux
notifications:
  email: false
deploy:
  provider: releases
  api_key:
    secure: dLZiCItgK0/OQGB/xolvDCWka3XraGP0m7J/3Dz9pC9Jx/i7Eu+O6s8KkNXMpDirVN++AkawQaTdOASRuFUjGFm4AqYVUOFMYmqyUkdFEsQubxVvk+WI8sy5Nev++mU8izJp2HpWMctVtSEUKdzcJWNDm2sT7XlL9XqEMieoqCEX6Mlkq41Uus3tmnE3XcHExUKZsaIsjtRb5nvtVda3zYXTXPM6A5+8Tz0DnCIj804wqWDIpxHShSEWUHl3KWtxsk9k9258ryeiH07MObJ89p6ccdNkqCnkE+JVgCOkoN0xsP929D8I33tdvv77WbRRR3Wfq9+NEioeyLuxou6y4iHs5UQ9gdj4NtOP0tE4+Ex7eYMbCqFdpQNjYsYB28Spiif3Gxepf2qVIKmI0K1TiscmINJfUuldJZPPJnCBIO0ZAnLN/O9U2jXUWUVbrbBe2vHRJ5DhOC0vUo7ne7WS9oOezNmZMl1TH4Vrd/xfW4K4iOL01kCx/5UhDaukDCGXmF1Cryex07WsIjYQhsJLD5fx7idH6PPs1VO1Mv+c93KDfWGr8Rq7X/bUZ9Al05sGfiV5iu6HFHHeGc9k6HSOCfdyHrZUOet6dBH5mlR6qBhE1haxaxcOUZr2JDob563ZhWGYKmJNTUz2o/7GJR6W/Z2pGQCmqA6qFbmBASr2YqI=
  file_glob: true
  file:
  - $HOME/gopath/bin/metrics-fetcher-xc/*/metrics-fetcher_*.tar.gz
  - $HOME/gopath/bin/metrics-fetcher-xc/*/metrics-fetcher_*.deb
  skip_cleanup: true
  on:
    tags: true
    go: 1.7.1
    repo: Wikia/metrics-fetcher
