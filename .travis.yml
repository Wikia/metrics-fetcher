sudo: false
language: go
matrix:
  allow_failures:
  - go: tip
  include:
  - go: 1.5.4
    env: GO15VENDOREXPERIMENT=1
  - go: 1.6.3
  - go: 1.7.1
    env: SEND_COVERAGE=1
  - go: tip
before_install:
- go get github.com/mattn/goveralls
- go get github.com/modocache/gover
- go get github.com/laher/goxc
install:
- make prepare
script:
- if ([ "$SEND_COVERAGE" == "1" ]); then make test-cover; else make test; fi
- make fmt-check
- if ([ "$TRAVIS_GO_VERSION" != "1.5.4" ]); then make lint; fi
- make vet
before_deploy:
- goxc
after_success:
- if ([ "$SEND_COVERAGE" == "1" ]); then gover && $HOME/gopath/bin/goveralls -service=travis-ci
  -coverprofile=gover.coverprofile; fi
os:
- linux
notifications:
  email: false
deploy:
  provider: releases
  api_key:
    secure: qamsar2OmVjCqapkDl0ZpNeTTqK5mmgfD0prUv9fNEz6Xsko1n8Bq5sPMqyxM2ipUzhlscg2azNorIKUsE6DQ86Ow53WaOgxFDEW27I3Ix4lhM8JYv6KsT5c2I0jQfzuunTs1YuJHFy+E/dXcqZtE0vrmlBD3gz/Gj4zXvsGxo4fZ9vEqWuq3j+XYG1FayUidayOBeZFEctUs6+DjLq42eRponkdpcQkJ/N2mTyPVSqJ12TIInILgdho2ZIpN9O01ZMwvoIyu3xM2efMX2adDeXtnEqNrIDA0or8tMFfGBMCI25GjOedTRpeUu2uuDZjevIMAcAbG79mdee8dPhYDFJFJf+vpThq8T+YFiWf4thsMn6ErSbIRNc8txv6Ot2Q0iz+4LzbRI0qC+/E0TrpKLZqpHdTCSz8CBn1vH5/JuJzQamhDwERNfsi2DzBFinwd+85pkUotWoqXG4crkL0RZhJWp5HHytnOk0bjViC1xBCWUd/2XuFaUa8OZgKsBJuOn+HpR0Uynodr4sZXZx5juaIS8+03ID7IUjViaQ+Han6GX+b+uQgdv1oVo7d77uoRFjliX3KW81l8kk8kjEP74K67u6zW9b0IMg/oipiGUqntlm0HE1+efmUP95atC/F1LjezEezBQxwRATxbTrTZR0ifPNMPjRscjsfOHiVQXc=
  file_glob: true
  file:
  - $HOME/gopath/bin/metrics-fetcher-xc/*/metrics-fetcher_*.tar.gz
  - $HOME/gopath/bin/metrics-fetcher-xc/*/metrics-fetcher_*.deb
  skip_cleanup: true
  on:
    tags: true
    go: 1.7.1
    repo: Wikia/metrics-fetcher
