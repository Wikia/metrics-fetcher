sudo: false
language: go
matrix:
  allow_failures:
  - go: tip
  include:
  - go: 1.5.4
    env: GO15VENDOREXPERIMENT=1
  - go: 1.6.3
  - go: 1.7.1
    env: SEND_COVERAGE=1
  - go: tip
before_install:
- go get github.com/mattn/goveralls
- go get github.com/modocache/gover
- go get github.com/laher/goxc
install:
- make prepare
script:
- if ([ "$SEND_COVERAGE" == "1" ]); then make test-cover; else make test; fi
- make fmt-check
- if ([ "$TRAVIS_GO_VERSION" != "1.5.4" ]); then make lint; fi
- make vet
before_deploy:
- goxc
deploy:
  provider: releases
  api_key:
    secure: CYzfOQ5pL7ZgXG6R+h1RryfJopLTKybk1B7vdj1LLMqCgpTrh4hlEMhJyiERYl+DvxdHk1GpMa9UFJT7Cu0XNattUmtaXrtPz2bMLcUd4z7nw0gU39apZ891JKy5MbB1TrchKh3BEZhNa5Cwh7A4MMugFXTcwEjdTPe4V9zGv9P/rltNZgc7Qg4KSvymzS5mxsGovEtZokfNNTVjv6OQa+Dd2j21VnMWUJV5mYCUkDMtGTiG7Zfns+slB8gDc3ciEqQqFrhfa6yB0fvZaw497H5sxRTdxF40+0BVgJ+zQJWKeNUHTVxDlp+ow/tMtBx2ofCPu49+i6iwQ8XEGYC4zRK0bWB15gdmIH6Ktnwb84V5JgM/UUooiWkqKLrnH35Yc9U9ki51BpPG8P7WoOHTSmIbRXLPlN8k44lxwBfBF6KRN+G3KW5unuvKlzuj51c/f+twFXWCZWdbv9c67tODtp3P0Gtf9ia013LmhDW0+yMhIDKOk38YfWtuk5dChsKoNPzPH2h+nZI3A4/OCckJzYfgWiqK74Y0R5YSHThl6mKnJNOWFyhEcoNQcIZlroQDCkx/HXicOw7kyhyMEJpV94P3TdUI+u/0eogIqx5afTq4SOZUCmB7lnMWapZLJbUz269YecJDtcy0mZknS98pK4VlI+1xCIOO8ZMIublMhio=
  file_glob: true
  file:
  - $HOME/gopath/bin/metrics-fetcher-xc/*/metrics-fetcher_*.tar.gz
  - $HOME/gopath/bin/metrics-fetcher-xc/*/metrics-fetcher_*.deb
  skip_cleanup: true
  on:
    tags: true
    go: 1.7.1
after_success:
- if ([ "$SEND_COVERAGE" == "1" ]); then gover && $HOME/gopath/bin/goveralls -service=travis-ci
  -coverprofile=gover.coverprofile; fi
os:
- linux
notifications:
  email: false
